import{r as e,f as t,p as s,T as a,a as n}from"./vendor.4d8d4fd7.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const a=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,l)=>{const o=new URL(e,a);if(self[t].moduleMap[o])return s(self[t].moduleMap[o]);const r=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){l(new Error(`Failed to import: ${e}`)),n(c)},onload(){s(self[t].moduleMap[o]),n(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("/assets/");let l=0;function o(){return"id-"+ ++l}function r(e){return{id:o(),title:e.toUpperCase(),isChecked:!1,subtasksIds:[],parentId:void 0}}const c={};for(const _ of["A","B","C","D"]){const e=r(_);c[e.id]=e}function u(e,t){const s=e[t];if(null!=s){for(let t of s.subtasksIds)u(e,t);if(s&&(delete e[t],void 0!==s.parentId&&e[s.parentId])){const a=e[s.parentId].subtasksIds.indexOf(t);-1!==a&&e[s.parentId].subtasksIds.splice(a,1)}}}a();const i=e.createContext(void 0);function k({children:s}){if(e.useContext(i))throw new Error("Can only be as single <TasksProvider>");const[a,n]=e.useState(c),l=e.useCallback((e=>{n(t((t=>{const s=t[e];null!=s&&(s.isChecked=!s.isChecked)})))}),[]),r=e.useCallback((e=>{n(t((t=>u(t,e))))}),[]),k=e.useCallback(((e,s)=>{n(t((t=>{const a={id:o(),title:e,isChecked:!1,subtasksIds:[],parentId:s};t[a.id]=a,void 0!==s&&t[s]&&t[s].subtasksIds.push(a.id)})))}),[]),d=e.useMemo((()=>({toggleTask:l,deleteTask:r,createTask:k,tasks:a,setTasks:n})),[l,r,k,a]);return e.createElement(i.Provider,{value:d},s)}i.displayName="TaskContext";const d=e.memo((function({children:a}){const n=e.useContext(i),[l,r]=e.useState(!1),[c,k]=e.useState([]),d=e.useMemo((()=>l?s(n.tasks,c):n.tasks),[l,n.tasks,c]);return e.createElement(i.Provider,{value:{toggleTask:l?function(e){t(d,(t=>{const s=t[e];null!=s&&(s.isChecked=!s.isChecked)}),(e=>k((t=>[...t,...e]))))}:n.toggleTask,deleteTask:l?function(e){t(d,(t=>u(t,e)),(e=>k((t=>[...t,...e]))))}:n.deleteTask,createTask:l?function(e,s){t(d,(t=>{const a={id:o(),title:e,isChecked:!1,subtasksIds:[],parentId:s};t[a.id]=a,void 0!==s&&t[s]&&t[s].subtasksIds.push(a.id)}),(e=>k((t=>[...t,...e]))))}:n.createTask,tasks:d,isDraft:l,cancelDraft:function(){r(!1),k([])},applyDraft:function(){r((e=>!e)),k([]),n.setTasks((e=>s(e,c)))},startDraft:function(){l||(r(!0),k([]))}}},a)}));function m({onTaskSelect:t,onTaskDeselect:s,taskId:a,children:n}){var l;const o=e.useRef(null),{task:r,subtasks:c,createTask:u,toggleTask:k,deleteTask:d}=function(t){const{tasks:s,createTask:a,toggleTask:n,deleteTask:l}=e.useContext(i),o=s[t],r=[];if(null==o)for(const e of Object.values(s))void 0===e.parentId&&r.push(e);else for(const e of o.subtasksIds)s[e]&&r.push(s[e]);return{task:o,subtasks:r,deleteTask:l,createTask:e=>a(e,null==o?void 0:o.id),toggleTask:n}}(a),{isDraft:m,isDraftable:f,applyDraft:p,cancelDraft:_,startDraft:b}=function(){const{isDraft:t,cancelDraft:s,applyDraft:a,startDraft:n}=e.useContext(i);return{isDraft:t,isDraftable:"boolean"==typeof t&&s&&a&&n&&!0,cancelDraft:s,applyDraft:a,startDraft:n}}(),[T,h]=e.useState("");return e.createElement(e.Fragment,null,e.createElement("article",{className:"Task "+(m?"Task--isDraft":"")},e.createElement("h2",{className:"Task__title"},e.createElement("div",{className:"Task__title__text"},null!=(l=null==r?void 0:r.title)?l:"Root"),f?m?e.createElement(e.Fragment,null,e.createElement("button",{type:"button",onClick:_,className:"Task__title__button"},"Dismiss"),e.createElement("button",{type:"button",onClick:p,className:"Task__title__button"},"Apply")):e.createElement("button",{type:"button",onClick:b,className:"Task__title__button"},"Start Draft"):null),e.createElement("ul",{hidden:0===c.length,className:"Task__subtasks"},c.map((a=>e.createElement("li",{key:a.id,role:"button",tabIndex:0,onKeyPress:e=>{e.target===e.currentTarget&&"Enter"===e.key&&!1===e.metaKey&&!1===e.ctrlKey&&!1===e.shiftKey&&!1===e.altKey&&t(a.id)},onClick:()=>t(a.id),className:"Task__subtask"},e.createElement("button",{type:"button",onClick:e=>{e.stopPropagation(),k(a.id)},className:"Task__subtask__button Task__subtask__button--check"},a.isChecked?"âœ”ï¸Ž":""),e.createElement("div",{className:"Task__subtask__text "+(a.isChecked?"Task__subtask__text--checked":"")},a.title),a.isChecked?e.createElement("button",{type:"button",onClick:e=>{e.stopPropagation();const{id:t}=a;d(t),s()},className:"Task__subtask__button"},"ðŸ—‘"):null)))),e.createElement("form",{onSubmit:function(e){e.preventDefault(),T&&(u(T),h(""),requestAnimationFrame((()=>{var e;null==(e=o.current)||e.scrollIntoView()})))},className:"Task__newTask"},e.createElement("input",{ref:o,type:"text",name:"task",value:T,autoComplete:"off",placeholder:"New task",onChange:e=>h(e.currentTarget.value),className:"Task__newTask__input"}))),n)}function f({children:[t,...s]}){return e.createElement(e.Fragment,null,t,0===s.length?null:e.createElement(f,null,s))}function p(){const[t,s]=e.useState([]);function a(e,t){s((s=>s.length===e?[...s,t]:s.slice(0,e).concat(t)))}function n(e){s((t=>e>=t.length?t:t.slice(0,e)))}return e.createElement("div",{className:"App"},e.createElement("h1",{className:"App__title"},"Contextual state"),e.createElement("div",{className:"App__tasks"},e.createElement(m,{onTaskSelect:e=>a(0,e),onTaskDeselect:()=>n(0)}),e.createElement(f,null,t.map(((t,s)=>e.createElement(d,{key:t},e.createElement(m,{key:s,taskId:t,onTaskSelect:e=>a(s+1,e),onTaskDeselect:()=>n(s+1)})))))))}n.render(e.createElement(e.StrictMode,null,e.createElement(k,null,e.createElement(p,null))),document.getElementById("root"));
